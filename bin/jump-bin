#!/usr/bin/env ruby

THIS_FILE = File.symlink?(__FILE__) ? File.readlink(__FILE__) : __FILE__

require "#{File.dirname(THIS_FILE)}/../lib/bookmarks"

options = {}
begin
  OptionParser.new do |opts|
    opts.banner = "Usage: example.rb [options]"

    opts.on("-a", "--add BOOKMARK", "Saves the current directory in BOOKMARK") do |v|
      options[:add] = v
    end

    opts.on("-d", "--del BOOKMARK", "Deletes BOOKMARK") do |v|
      options[:del] = v
    end

    opts.on("-l", "--list", "Prints the list of all saved bookmarks") do |v|
      options[:list] = true
    end

    opts.on_tail("-h", "--help", "Show this message") do
      puts opts
      exit
    end
  end.parse!
rescue OptionParser::InvalidOption
  STDERR.puts $!
  exit 1
end

bookmarks = Bookmarks.new

if options.has_key?(:add)
  bookmarks.add(Dir.pwd, options[:add])
  bookmarks.save
end

if options.has_key?(:del)
  bookmarks.del(options[:del])
  bookmarks.save
end

puts bookmarks if options.has_key?(:list)

if ARGV.size == 1
  expanded_path = bookmarks.expand_path(ARGV[0])
  puts expanded_path unless expanded_path.nil?
end